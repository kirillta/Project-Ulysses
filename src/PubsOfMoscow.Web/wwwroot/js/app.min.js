"use strict";function initMap(){sendRequest("GET","hereapps",null,renderMap)}function addMapEvents(){map.addEventListener("tap",function(n){console.log(n.type,n.currentPointer.type)});new H.mapevents.Behavior(new H.mapevents.MapEvents(map))}function renderMap(n){platform=new H.service.Platform({app_id:n[0],app_code:n[1]});maptypes=platform.createDefaultLayers();map=new H.Map(document.getElementById("MapContainer"),maptypes.normal.map,{zoom:12,center:{lng:37.625,lat:55.75}});ui=H.ui.UI.createDefault(map,maptypes,"ru-RU");addMapEvents()}function renderMapMarkers(n){var t,i,h,r,v;if(!isMarkerRendered){t=new H.map.Group;map.addObject(t);t.addEventListener("tap",function(n){var t=new H.ui.InfoBubble(n.target.getPosition(),{content:n.target.getData()});ui.addBubble(t)},!1);var u=!0,o=!1,s=undefined;try{for(i=n[Symbol.iterator]();!(u=(h=i.next()).done);u=!0){var c=h.value,f=!0,l=!1,a=undefined;try{for(r=c.pubs[Symbol.iterator]();!(f=(v=r.next()).done);f=!0){var e=v.value,w="<div><p>"+e.title+"<\/p><p>"+c.number+"-й раунд<\/p><\/div>",y=new H.map.Marker({lat:e.latitude,lng:e.longitude});y.setData(w);t.addObject(y)}}catch(p){l=!0;a=p}finally{try{!f&&r["return"]&&r["return"]()}finally{if(l)throw a;}}}}catch(p){o=!0;s=p}finally{try{!u&&i["return"]&&i["return"]()}finally{if(o)throw s;}}isMarkerRendered=!0}}function getCongratulations(){sendRequest("GET","congratulations",null,renderCongratulations)}function getRounds(){sendRequest("GET","rounds",null,renderPubChart)}function sendCongratulation(){var n=document.getElementById("CongratulationText"),t={content:n.value};sendRequest("POST","congratulations",t);n.value="";document.getElementById("CongratulationSubmit").value="Написать ещё"}function sendRequest(n,t,i,r){var f="/api/"+t,u=new XMLHttpRequest;u.open(n,f,!0);u.contentType="application/json";u.setRequestHeader("content-type","application/json");u.setRequestHeader("cache-control","no-cache");i!==null?u.send(JSON.stringify(i)):u.send();u.onreadystatechange=function(){if(u.readyState===4)if(document.body.style.cursor="default",u.status>=200&&u.status<300){if(r!==undefined&&r!==null){var n=JSON.parse(u.responseText);r(n)}}else console.log(u.status+": "+u.statusText)};document.body.style.cursor="wait"}function assignCongratulationEvent(){var n=document.getElementById("CongratulationSubmit");n.addEventListener("click",sendCongratulation)}function ready(){initMap();getRounds();setInterval(getRounds,6e4);getCongratulations();assignCongratulationEvent()}var isMarkerRendered=!1,platform,maptypes,map,ui,renderCongratulations=function(n){var r="",i=!0,u=!1,f=undefined,t,e,o;try{for(t=n[Symbol.iterator]();!(i=(e=t.next()).done);i=!0)o=e.value,r+="<p>«"+o+"»<\/p>"}catch(s){u=!0;f=s}finally{try{!i&&t["return"]&&t["return"]()}finally{if(u)throw f;}}document.getElementById("CongratulationList").innerHTML=r},getTimeFrame=function(n,t){if(n==="0001-01-01T00:00:00")return"TBD";if(n==="1980-01-01T00:00:00")return"—";var r=n.indexOf("T")+1,u=n.lastIndexOf(":"),i=n.substring(r,u);return t||(i="~"+i),i},getPubDescription=function(n){var i="deactivated",r=getTimeFrame(n.estimateStartTime,n.isChosen),t=n.title;return n.isChosen&&(i="activated",t+=" ⭐"),'<div class="pub-desc '+i+' text-centered">\n        <img src="images/logos/'+n.logoUrl+'" alt="'+t+'"/>\n        <div>\n            <span class="title">'+t+'<\/span>\n            <br />\n            <span class="address">'+n.address+'<\/span>\n            <div class ="time-frame">'+r+"<\/div>\n        <\/div>\n    <\/div>"},getPubGroup=function(n){var r='<hr /><div id="Group'+n.number+'" class="pub-chart">',i=!0,u=!1,f=undefined,t,e,o;try{for(t=n.pubs[Symbol.iterator]();!(i=(e=t.next()).done);i=!0)o=e.value,r+=getPubDescription(o)}catch(s){u=!0;f=s}finally{try{!i&&t["return"]&&t["return"]()}finally{if(u)throw f;}}return r+"<\/div>"},renderPubChart=function(n){var r="",i=!0,u=!1,f=undefined,t,e,o;try{for(t=n[Symbol.iterator]();!(i=(e=t.next()).done);i=!0)o=e.value,r+=getPubGroup(o)}catch(s){u=!0;f=s}finally{try{!i&&t["return"]&&t["return"]()}finally{if(u)throw f;}}document.getElementById("PubChart").innerHTML=r.substring(6);renderMapMarkers(n)};document.addEventListener("DOMContentLoaded",ready);